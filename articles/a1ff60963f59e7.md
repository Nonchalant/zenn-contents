---
title: "Github Actionsã§Unityè£½ã‚¢ãƒ—ãƒªã‚’Steamã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹"
emoji: "ğŸ¤–"
type: "tech"
topics: [Unity, Steam, Steamworks, GitHubActions]
published: true
---

#### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ

```sh
$ sw_vers
ProductName:		macOS
ProductVersion:		15.2
BuildVersion:		24C101
```

ä»Šå›ã®è¨˜äº‹ã®ã‚µãƒ³ãƒ—ãƒ«ã¯[SteamDeploySample](https://github.com/Nonchalant/SteamDeploySample)ã«ãªã‚Šã¾ã™ã€‚

![](/images/a1ff60963f59e7/GitHubActions_Log.jpeg)

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®Steamã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

CIã§ã®è‡ªå‹•åŒ–ã®å‰ã«ã€ã¾ãšã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§Steamã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºèªã—ã¾ã™ã€‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼ã¯[Steamworks SDK](https://partner.steamgames.com/doc/sdk)ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã®è¨˜äº‹ã§ã¯ç°¡ç•¥åŒ–ã—ãŸãƒ•ãƒ­ãƒ¼ã‚’èª¬æ˜ã—ã¾ã™ã€‚

1. Unity Editorã§å„ç¨®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†
2. Steamworksã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨SDKã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆåˆå›ã®ã¿ï¼‰
    - [ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯](https://partner.steamgames.com/downloads/list)
3. AppIDã€DepotIDã€å„ç¨®ãƒ“ãƒ«ãƒ‰ã¸ã®ãƒ‘ã‚¹ã‚’è¨˜è¼‰ã—ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
    - [è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†æ–¹æ³•](https://partner.steamgames.com/doc/sdk/uploading)
4. SDKã«å†…åŒ…ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§èªè¨¼æƒ…å ±ã‚’ä»˜ä¸ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

Unity Editorã§ã®ãƒ“ãƒ«ãƒ‰ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ãªã©ã‚‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã—ã¦ä½œæ¥­ã§ãã¾ã™ãŒã€ç¤¾å†…ç¢ºèªãªã©ã§å®šæœŸå®Ÿè¡Œã—ãŸã„å ´åˆã«ã¯ä½œæ¥­æ™‚é–“ã«å½±éŸ¿ãŒã‚ã‚‹ãŸã‚ã€CIã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

## CIã§ã®Steamã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

Unityè£½ã‚¢ãƒ—ãƒªã®CIã«ã¯[GameCI](https://game.ci/docs/github/getting-started)ãŒä¾¿åˆ©ã§ã™ã€‚ã“ã‚Œã‚’æ´»ç”¨ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚ä»Šå›ã¯GitHub Actionsã§è‡ªå‹•åŒ–ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨ä½“ã§ã™ã€‚

```yml:main.yml
name: Upload to Steam

# 1. æ¯é€±æœˆæ›œæ—¥ã®11æ™‚ã«å®šæœŸå®Ÿè¡Œ
# 2. GitHubä¸Šã§ã®æ‰‹å‹•å®Ÿè¡Œ
on:
  schedule:
    - cron: '0 2 * * 1'
  workflow_dispatch:
    inputs:
      environment: # ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®æŒ‡å®š
        type: choice
        required: true
        default: "debug"
        options:
          - "debug"
          - "prerelease"
          - "default"
        description: Deployment environment

# è¤‡æ•°ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼ãŒç™ºç«ã—ã¦ã„ã‚‹éš›ã«å¤ã„ãƒ•ãƒ­ãƒ¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
    
jobs:
  build: # Unityè£½ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ãƒ•ãƒ­ãƒ¼
    runs-on: ubuntu-latest
    outputs:
      buildVersion: ${{ steps.buildStep.outputs.buildVersion }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Create LFS file list
        run: git lfs ls-files -l | cut -d' ' -f1 | sort > .lfs-assets-id
        
      - name: Restore LFS cache
        uses: actions/cache@v3
        id: lfs-cache
        with:
          path: .git/lfs
          key: ${{ runner.os }}-lfs-${{ hashFiles('.lfs-assets-id') }}
          
      - name: Git LFS Pull
        run: |
          git lfs pull
          git add .
          git reset --hard

      - name: Set Build Version
        id: buildStep
        run: echo "buildVersion=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT
      
      - uses: actions/cache@v3
        with:
          path: Library
          key: Library-${{ hashFiles('Assets/**', 'Packages/**', 'ProjectSettings/**') }}
          restore-keys: |
            Library-
          
      # Windows 64bitå‘ã‘ã®ãƒ“ãƒ«ãƒ‰
      - name: Run the Windows build
        uses: game-ci/unity-builder@v4
        env:
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
        with:
          targetPlatform: StandaloneWindows64
          unityVersion: 2022.3.50f1 # æ‰‹å…ƒã®Unity Versionã«ç½®ãæ›ãˆã‚‹
          versioning: Semantic
          
      # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼ã§å‚ç…§ã§ãã‚‹ã‚ˆã†ã«GitHub Actionsä¸Šã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Build-${{ steps.buildStep.outputs.buildVersion }}
          path: build
  
  deploy: # Steamã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼
    needs: [build]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      # ãƒ“ãƒ«ãƒ‰ãƒ•ãƒ­ãƒ¼ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸç”Ÿæˆç‰©ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      - name: Download Artifact
        uses: actions/download-artifact@v4
        with:
          name: Build-${{ needs.build.outputs.buildVersion }}
          
      # Secretsã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹Steamã®èªè¨¼æƒ…å ±ã‚’ç”¨ã„ã¦Steamã¸ãƒ‡ãƒ—ãƒ­ã‚¤
      - uses: game-ci/steam-deploy@v3
        with:
          username: ${{ secrets.STEAM_USERNAME }}
          configVdf: ${{ secrets.STEAM_CONFIG_VDF }}
          appId: ${{ secrets.STEAM_APP_ID }}
          buildDescription: v${{ needs.build.outputs.buildVersion }}
          rootPath: StandaloneWindows64
          depot1Path: .
          depot1InstallScriptPath: ./install_script.vdf
          releaseBranch: ${{ github.event.inputs.environment }} # ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ
```

å®Ÿéš›ã«GitHub Actionsã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã¯åˆå›ã®ã¿å„ç¨®è¨­å®šãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

### Steamworksã§ã®Deployå…ˆã®è¨­å®š

ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¯ç¤¾å†…ç¢ºèªã€ãƒªãƒªãƒ¼ã‚¹å‰ç¢ºèªã€ãƒªãƒªãƒ¼ã‚¹ãªã©æ§˜ã€…ãªç”¨é€”ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€GitHub Actionsä¸Šã§ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚ãã‚Œãã‚Œã®ç”¨é€”ã«å¯¾å¿œã™ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’Steamworksã®ç®¡ç†ç”»é¢ã§è¨­å®šã—ã¾ã™ã€‚

```yml:main.yml
on:
  schedule:
    - cron: '0 2 * * 1'
  workflow_dispatch:
    inputs:
      environment: # ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®æŒ‡å®š
        type: choice
        required: true
        default: "debug"
        options: # å„ç¨®é¸æŠè‚¢ã‚’Steamworksã®ç®¡ç†ç”»é¢ä¸Šã§è¨­å®š
          - "debug"
          - "prerelease"
          - "default"
        description: Deployment environment
```

![](/images/a1ff60963f59e7/Steamworks_Branch.png)
*Steamworksã§ã®è¨­å®š*

### GitHubã§ã®èªè¨¼æƒ…å ±ã®è¨­å®š

CLIä¸Šã§Unityè£½ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ã‚„Steamã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã†ãŸã‚ã«ã€å„ç¨®èªè¨¼æƒ…å ±ã‚’GitHub Actionsã§å‚ç…§ã§ãã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚`STEAM_CONFIG_VDF`ã‚„`UNITY_LICENSE`ã®è¨­å®šã¯å°‘ã—ç…©é›‘ãªã®ã§ã€Makefileã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã—ã¦ã„ã¾ã™ã€‚

| Key | Format | Description |
| ---- | ---- | ---- |
| STEAM_APP_ID | text | Steamworksã®ç™»éŒ²ã‚¢ãƒ—ãƒªID |
| STEAM_CONFIG_VDF | base64 | `$ make generate_steam_config` |
| STEAM_USERNAME | text | Steamworksã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¦ãƒ¼ã‚¶å |
| UNITY_EMAIL | text | https://unity.com ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| UNITY_LICENSE | xml | `$ make generate_unity_licens` |
| UNITY_PASSWORD | text | https://unity.com ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |

![](/images/a1ff60963f59e7/GitHub_Secrets.png)
*GitHubã§ã®èªè¨¼æƒ…å ±ã®è¨­å®š*

Makefileã‚’æ´»ç”¨ã—ã¦Buildãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã«ç”Ÿæˆã•ã‚Œã‚‹`config_base64.txt`ã‚„`Unity_lic.ulf`ã®ä¸­èº«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€`STEAM_CONFIG_VDF`ã‚„`UNITY_LICENSE`ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚

```sh:.env
STEAM_USER_NAME=XXX
```

https://github.com/Nonchalant/SteamDeploySample/blob/main/Makefile

### GitHub Actionsã§ã®å®Ÿè¡Œ

å„ç¨®èªè¨¼æƒ…å ±ã‚’è¨­å®šã—ãŸã‚‰ã€GitHub Actionsã§æ‰‹å‹•å®Ÿè¡ŒãŒå¯èƒ½ã«ãªã‚Šã€Steamworksä¸Šã§ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã›ãšã«ã€CIä¸Šã§Steamã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

| æ‰‹å‹•å®Ÿè¡Œ | å®Ÿè¡Œãƒ­ã‚° | ãƒ“ãƒ«ãƒ‰ |
|---|---|---|
|![](/images/a1ff60963f59e7/GitHubActions_Trigger.jpeg)|![](/images/a1ff60963f59e7/GitHubActions_Log.jpeg)|![](/images/a1ff60963f59e7/Steamworks_Builds.png)|

## ã¾ã¨ã‚

ä»Šå›ã®è¨˜äº‹ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ã€[SteamDeploySample](https://github.com/Nonchalant/SteamDeploySample)ã«ãªã‚Šã¾ã™ã€‚GitHub Actionsã®å®Ÿè¡Œãƒ­ã‚°ã‚‚ç¢ºèªã§ãã‚‹ã®ã§ã€å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

- https://game.ci/docs/github/getting-started
- https://github.com/game-ci/steam-deploy
- https://qiita.com/broken55/items/2ca7d8b261ed12bb3820
